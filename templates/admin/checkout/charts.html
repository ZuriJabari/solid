{% extends "admin/base_site.html" %}
{% load i18n admin_urls %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
<style>
    .chart-container {
        position: relative;
        margin: 20px 0;
        height: 300px;
        width: 100%;
    }
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    .metric-card {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .metric-value {
        font-size: 24px;
        font-weight: bold;
        color: #2c5282;
    }
    .metric-label {
        font-size: 14px;
        color: #4a5568;
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-value">{{ total_orders }}</div>
            <div class="metric-label">Total Orders</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">${{ total_revenue|floatformat:2 }}</div>
            <div class="metric-label">Total Revenue</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">{{ success_rate }}%</div>
            <div class="metric-label">Success Rate</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">${{ avg_order_value|floatformat:2 }}</div>
            <div class="metric-label">Average Order Value</div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="dailyOrdersChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="monthlyRevenueChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="pickupDistributionChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="paymentMethodsChart"></canvas>
    </div>
</div>

<script>
    // Common chart options
    const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top'
            }
        }
    };

    // Daily Orders Chart
    const dailyOrdersCtx = document.getElementById('dailyOrdersChart').getContext('2d');
    new Chart(dailyOrdersCtx, {
        type: 'line',
        data: {
            labels: JSON.parse('{{ daily_labels|escapejs }}'),
            datasets: [{
                label: 'Daily Orders',
                data: JSON.parse('{{ daily_orders|escapejs }}'),
                borderColor: '#4299e1',
                backgroundColor: 'rgba(66, 153, 225, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            ...commonOptions,
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'day',
                        displayFormats: {
                            day: 'MMM D'
                        }
                    },
                    title: {
                        display: true,
                        text: 'Date'
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Orders'
                    }
                }
            }
        }
    });

    // Monthly Revenue Chart
    const monthlyRevenueCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
    new Chart(monthlyRevenueCtx, {
        type: 'bar',
        data: {
            labels: JSON.parse('{{ monthly_labels|escapejs }}'),
            datasets: [{
                label: 'Monthly Revenue',
                data: JSON.parse('{{ monthly_revenue|escapejs }}'),
                backgroundColor: '#48bb78'
            }]
        },
        options: {
            ...commonOptions,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Revenue ($)'
                    }
                }
            }
        }
    });

    // Pickup Distribution Chart
    const pickupDistCtx = document.getElementById('pickupDistributionChart').getContext('2d');
    new Chart(pickupDistCtx, {
        type: 'line',
        data: {
            labels: JSON.parse('{{ pickup_hours|escapejs }}'),
            datasets: [{
                label: 'Pickup Distribution',
                data: JSON.parse('{{ pickup_counts|escapejs }}'),
                borderColor: '#9f7aea',
                backgroundColor: 'rgba(159, 122, 234, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            ...commonOptions,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Hour of Day'
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Pickups'
                    }
                }
            }
        }
    });

    // Payment Methods Chart
    const paymentMethodsCtx = document.getElementById('paymentMethodsChart').getContext('2d');
    new Chart(paymentMethodsCtx, {
        type: 'doughnut',
        data: {
            labels: JSON.parse('{{ payment_methods|escapejs }}'),
            datasets: [{
                data: JSON.parse('{{ payment_counts|escapejs }}'),
                backgroundColor: [
                    '#4299e1',
                    '#48bb78',
                    '#ecc94b',
                    '#ed64a6'
                ]
            }]
        },
        options: {
            ...commonOptions,
            plugins: {
                legend: {
                    position: 'right'
                },
                title: {
                    display: true,
                    text: 'Payment Methods Distribution'
                }
            }
        }
    });
</script>
{% endblock %} 